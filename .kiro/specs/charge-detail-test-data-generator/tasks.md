# 维度统计测试数据生成模块 - 实现任务

## 任务列表

- [ ] 1. 创建数据库模型和迁移脚本
  - 创建维度统计表（dws_adv_dimension_points）的SQLAlchemy模型
  - 创建测试数据生成任务表（test_data_generation_tasks）的SQLAlchemy模型
  - 编写Alembic迁移脚本，添加必要的表和字段
  - _需求: 1.1, 3.1, 3.2, 3.6, 5.1_

- [ ] 2. 实现后端数据模型和Schema
  - 编写维度统计数据模型（DimensionStatistics）
  - 编写测试数据生成任务模型（TestDataGenerationTask）
  - 创建Pydantic Schema用于任务创建、配置和响应
  - 定义约束条件的数据结构（科室约束、维度约束）
  - _需求: 1.1, 1.2, 1.3, 1.4, 1.5_

- [ ] 3. 实现核心数据生成算法
  - 编写维度收入分配算法，根据约束条件计算每个维度的收入金额
  - 实现科室总额自动分配逻辑（当用户未指定时）
  - 实现维度比例自动计算逻辑（基于维度权重）
  - 实现收入总和校验逻辑，确保科室维度收入总和等于科室总额（误差<1元）
  - 实现全院总收入校验逻辑，确保所有科室收入总和等于全院总收入
  - _需求: 2.1, 2.2, 2.3, 2.4, 2.5, 4.1, 4.2, 4.3_

- [ ] 4. 实现数据生成服务层
  - 创建TestDataGenerationService类，封装数据生成业务逻辑
  - 实现加载模型版本和末级维度节点的方法
  - 实现生成维度统计数据的主流程方法
  - 实现数据写入维度统计表的方法
  - 实现数据覆盖检查和处理逻辑
  - 实现事务回滚机制，确保数据一致性
  - _需求: 2.1, 3.1, 3.3, 3.4, 3.5, 3.6_

- [ ] 5. 实现数据质量验证模块
  - 创建DataValidationService类
  - 实现全院总收入验证方法
  - 实现科室总收入验证方法
  - 实现维度收入约束验证方法
  - 实现生成验证报告的方法
  - _需求: 4.1, 4.2, 4.3, 4.4, 4.5_

- [ ] 6. 实现任务管理功能
  - 创建任务创建API端点（POST /api/test-data-generation/tasks）
  - 实现任务状态更新逻辑（排队中、运行中、已完成、失败）
  - 实现任务执行日志记录功能
  - 实现任务统计信息记录（科室数量、维度数量、记录数量、总金额）
  - 实现任务取消功能
  - 创建任务列表查询API端点（GET /api/test-data-generation/tasks）
  - 创建任务详情查询API端点（GET /api/test-data-generation/tasks/{task_id}）
  - _需求: 5.1, 5.2, 5.3, 5.4, 5.5, 5.6_

- [ ] 7. 实现Celery异步任务
  - 创建Celery任务函数用于异步执行数据生成
  - 实现任务进度更新机制
  - 实现任务错误处理和重试逻辑
  - 配置Celery任务队列和worker
  - _需求: 5.1, 5.2, 5.5_

- [ ] 8. 实现前端数据生成配置页面
  - 创建TestDataGeneration.vue组件
  - 实现约束条件配置表单（目标年月、全院总收入、模型版本选择）
  - 实现科室列表展示和科室总额配置
  - 实现维度列表展示和维度金额/比例配置
  - 实现已分配总额和剩余总额的实时计算显示
  - 实现科室维度比例总和的实时计算显示（应等于100%）
  - 实现表单验证逻辑
  - 实现任务提交功能
  - _需求: 6.1, 6.2, 6.3, 6.4_

- [ ] 9. 实现前端任务管理页面
  - 创建TestDataGenerationTasks.vue组件
  - 实现任务列表展示（状态、创建时间、统计信息）
  - 实现任务状态实时更新（使用轮询或WebSocket）
  - 实现查看任务详细日志功能
  - 实现查看验证报告功能
  - 实现任务取消功能
  - 添加路由配置
  - _需求: 6.5, 6.6_

- [ ] 10. 实现前端API集成
  - 创建test-data-generation.ts API模块
  - 实现创建任务的API调用方法
  - 实现查询任务列表的API调用方法
  - 实现查询任务详情的API调用方法
  - 实现取消任务的API调用方法
  - 实现查询模型版本和维度的API调用方法
  - _需求: 6.1, 6.5_

- [ ] 11. 实现高级功能（可选）
  - 实现随机波动功能（±5%）
  - 实现多月连续生成功能
  - 实现约束条件模板保存和加载功能
  - 实现从Excel导入约束条件配置功能
  - 实现导出约束条件配置为Excel功能
  - _需求: 7.1, 7.2, 7.3, 7.4, 7.5_

- [ ]* 12. 编写测试和文档
  - 编写数据生成算法的单元测试
  - 编写数据验证逻辑的单元测试
  - 编写API端点的集成测试
  - 编写用户使用文档
  - 编写开发者技术文档
  - _需求: 所有需求_

