# 模型版本导入功能 - 需求文档

## 简介

本文档定义了模型版本导入功能的需求。该功能允许用户从系统中其他医疗机构的模型版本中导入结构和配置,以提高模型复用性,快速复制现有知识。

## 术语定义

| 术语 | 定义 |
|---|---|
| **源医疗机构** | 提供模型版本的医疗机构 |
| **目标医疗机构** | 接收导入模型版本的医疗机构 |
| **模型版本导入** | 将其他医疗机构的模型版本复制到目标医疗机构的操作 |
| **完整导入** | 导入模型版本的所有内容,包括模型结构、计算流程、计算步骤 |
| **选择性导入** | 仅导入模型结构,不导入计算流程 |

## 需求

### 需求 1: 查看可导入的模型版本列表

**用户故事**: 作为模型设计师,我想查看系统中其他医疗机构的模型版本列表,以便选择合适的版本进行导入。

#### 验收标准

1. WHEN 用户打开模型版本管理页面, THE 系统 SHALL 提供"导入版本"按钮
2. WHEN 用户点击"导入版本"按钮, THE 系统 SHALL 显示可导入的模型版本列表对话框
3. THE 系统 SHALL 显示所有其他医疗机构的模型版本(不包括当前医疗机构的版本)
4. THE 系统 SHALL 为每个版本显示以下信息: 版本号、版本名称、所属医疗机构名称、版本描述、创建时间
5. THE 系统 SHALL 提供搜索功能,支持按版本号、版本名称、医疗机构名称进行模糊搜索
6. THE 系统 SHALL 提供分页功能,每页显示10条记录

### 需求 2: 预览模型版本详情

**用户故事**: 作为模型设计师,我想在导入前预览模型版本的详细信息,以便确认是否符合我的需求。

#### 验收标准

1. WHEN 用户在可导入版本列表中选择某个版本, THE 系统 SHALL 显示该版本的详细信息
2. THE 系统 SHALL 显示模型版本信息
3. THE 系统 SHALL 显示该版本关联的计算流程数量

### 需求 3: 选择导入选项

**用户故事**: 作为模型设计师,我想选择导入的内容范围,以便根据实际需要进行灵活导入。

#### 验收标准

1. WHEN 用户确认要导入某个版本, THE 系统 SHALL 显示导入选项对话框
2. THE 系统 SHALL 提供"导入内容"选项,包括:
   - 仅导入模型结构(默认选中)
   - 导入模型结构和计算流程
3. THE 系统 SHALL 提供"新版本信息"输入框,包括:
   - 版本号(必填,不能与当前医疗机构已有版本重复)
   - 版本名称(必填)
   - 版本描述(可选)
4. THE 系统 SHALL 验证版本号的唯一性(仅在当前医疗机构内)
5. IF 用户选择导入计算流程, THEN THE 系统 SHALL 显示警告提示: "计算流程中的SQL代码可能需要根据您的数据库结构进行调整"

### 需求 4: 执行导入操作

**用户故事**: 作为模型设计师,我想执行导入操作,以便快速获得一个可用的模型版本。

#### 验收标准

1. WHEN 用户点击"确认导入"按钮, THE 系统 SHALL 开始执行导入操作
2. THE 系统 SHALL 显示导入进度指示器
4. THE 系统 SHALL 按以下顺序执行导入:
   - 创建新的模型版本记录
   - 复制模型结构(所有节点)
   - 如果选择导入计算流程,复制所有计算流程和计算步骤
5. THE 系统 SHALL 确保导入操作的原子性,如果任何步骤失败,回滚所有更改
6. WHEN 导入完成, THE 系统 SHALL 显示成功提示,包括导入的统计信息
7. WHEN 导入失败, THE 系统 SHALL 显示详细的错误信息

### 需求 5: 查看导入结果

**用户故事**: 作为模型设计师,我想查看导入操作的详细结果,以便了解导入了哪些内容。

#### 验收标准

1. WHEN 导入成功, THE 系统 SHALL 显示导入结果摘要,包括:
   - 新版本的版本号和名称
   - 导入的节点数量
   - 导入的计算流程数量(如果适用)
   - 导入的计算步骤数量(如果适用)
2. THE 系统 SHALL 提供"查看新版本"按钮,点击后跳转到新版本的详情页面
3. THE 系统 SHALL 在模型版本列表中显示新导入的版本
4. THE 系统 SHALL 将新导入的版本标记为"未激活"状态

### 需求 6: 权限控制

**用户故事**: 作为系统管理员,我想控制哪些用户可以导入模型版本,以便确保数据安全。

#### 验收标准

1. THE 系统 SHALL 仅允许具有"模型设计师"或"系统管理员"角色的用户执行导入操作
2. THE 系统 SHALL 仅允许用户导入到自己所属的医疗机构
3. THE 系统 SHALL 记录导入操作的审计日志,包括操作用户、源版本、目标版本、导入时间、导入选项

## 非功能性需求

### 性能需求

1. THE 系统 SHALL 在5秒内完成可导入版本列表的加载
2. THE 系统 SHALL 在30秒内完成大规模模型版本(200个节点,10个计算流程,100个计算步骤)的导入操作

### 可用性需求

1. THE 系统 SHALL 提供清晰的导入向导界面,引导用户完成导入操作
2. THE 系统 SHALL 在每个步骤提供帮助文本,说明该步骤的作用
3. THE 系统 SHALL 在导入前显示确认对话框,列出将要导入的内容

### 可靠性需求

1. THE 系统 SHALL 确保导入操作的原子性,失败时完全回滚
2. THE 系统 SHALL 在导入过程中发生错误时,提供详细的错误信息和建议的解决方案
3. THE 系统 SHALL 在导入完成后,验证导入数据的完整性

## 约束条件

1. 导入操作仅支持从同一系统内的其他医疗机构导入,不支持从外部文件导入
2. 导入的模型版本必须与当前系统版本兼容
3. 导入操作不会修改源医疗机构的数据
4. 导入后的版本与源版本完全独立,后续修改互不影响
