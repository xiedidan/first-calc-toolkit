# 需求文档 - 模型规则展示功能

## 简介

本文档定义了为评估模型节点添加规则字段，并提供独立的规则展示页面的需求。规则字段用于存储节点的自然语言描述（可能几百字），帮助用户理解每个节点的业务含义和计算规则。

## 需求

### 需求 1：为模型节点添加规则字段

**用户故事：** 作为模型设计师，我希望能够为每个模型节点（包括序列和维度）添加规则说明，以便记录节点的业务含义、计算逻辑和使用说明。

#### 验收标准

1. WHEN 模型设计师创建或编辑模型节点时 THEN 系统应提供一个"规则说明"输入框
2. WHEN 模型设计师输入规则说明时 THEN 系统应支持最多1000字的自然语言文本输入
3. WHEN 模型设计师保存节点时 THEN 系统应将规则说明保存到数据库的 `rule` 字段
4. WHEN 规则说明为空时 THEN 系统应允许保存（规则字段为可选项）
5. WHEN 模型设计师编辑已有节点时 THEN 系统应显示之前保存的规则说明

### 需求 2：规则字段不在模型结构表中显示

**用户故事：** 作为模型设计师，我希望规则说明不在模型结构表格中显示，以保持表格的简洁性，因为规则说明通常较长。

#### 验收标准

1. WHEN 用户查看模型结构表格时 THEN 系统不应在表格列中显示规则字段
2. WHEN 用户点击编辑节点时 THEN 系统应在编辑对话框中显示规则输入框
3. WHEN 用户在编辑对话框中查看规则时 THEN 系统应完整显示规则内容

### 需求 3：创建独立的模型规则展示页面

**用户故事：** 作为业务专家或模型设计师，我希望有一个独立的页面以树形结构展示所有节点的规则说明，以便快速查看和理解整个模型的业务逻辑。

#### 验收标准

1. WHEN 用户在模型版本列表中点击某个版本的"查看规则"按钮时 THEN 系统应导航到该版本的规则展示页面
2. WHEN 用户进入规则展示页面时 THEN 系统应以树形结构展示该版本的所有节点
3. WHEN 用户查看树形结构时 THEN 每个节点应显示：节点名称、节点编码、节点类型标签
4. WHEN 用户展开某个节点时 THEN 系统应显示该节点的规则说明内容
5. WHEN 某个节点没有规则说明时 THEN 系统应显示"暂无规则说明"的提示
6. WHEN 用户查看规则展示页面时 THEN 系统应提供返回版本列表的按钮

### 需求 4：规则展示页面的交互体验

**用户故事：** 作为用户，我希望规则展示页面提供良好的浏览体验，能够方便地查看和搜索规则内容。

#### 验收标准

1. WHEN 用户进入规则展示页面时 THEN 系统应默认展开第一层节点
2. WHEN 用户点击节点时 THEN 系统应展开/收起该节点的子节点
3. WHEN 用户查看规则内容时 THEN 系统应保持文本格式（换行、空格等）
4. WHEN 页面加载时 THEN 系统应显示加载状态
5. WHEN 加载失败时 THEN 系统应显示友好的错误提示

### 需求 5：数据库字段已存在

**用户故事：** 作为开发人员，我需要确认数据库中已经存在 `rule` 字段，以便直接使用而无需创建数据库迁移。

#### 验收标准

1. WHEN 检查 `model_nodes` 表结构时 THEN 应存在 `rule` 字段（TEXT类型）
2. WHEN 后端API接收节点数据时 THEN 应支持 `rule` 字段的读写
3. WHEN 前端提交节点数据时 THEN 应包含 `rule` 字段

## 非功能性需求

### 性能

1. 规则展示页面应在2秒内加载完成（包含100个节点的模型）
2. 树形结构的展开/收起操作应即时响应（< 100ms）

### 可用性

1. 规则输入框应支持多行文本输入
2. 规则输入框应显示字数统计
3. 规则展示页面应支持打印功能（可选）

### 兼容性

1. 规则展示页面应与现有的模型管理功能保持一致的UI风格
2. 规则字段的添加不应影响现有的模型节点功能

## 附录

### 相关文档

- 需求文档.md - 项目整体需求
- 系统设计文档.md - 系统架构设计
- API设计文档.md - API接口规范

### 数据库字段

`model_nodes` 表中的 `rule` 字段：
- 类型：TEXT
- 可空：是
- 说明：节点的规则说明（自然语言描述）
