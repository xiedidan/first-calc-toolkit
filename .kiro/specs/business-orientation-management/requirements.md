# 业务导向管理 - 需求文档

## 简介

业务导向管理模块用于定义和管理医院科室业务价值评估中的导向规则、基准和阶梯配置。该模块支持三种导向类别（基准阶梯、直接阶梯、其他），并与评估模型的末级节点关联，实现从文本描述到结构化规则的升级。

## 术语表

- **系统**：医院科室业务价值评估系统
- **导向规则**：定义业务导向的主要规则，包括名称、类别和描述
- **导向基准**：针对"基准阶梯"类别导向，为每个科室设置的基准值配置
- **导向阶梯**：针对"基准阶梯"和"直接阶梯"类别导向，定义的分级调整规则
- **基准类别**：统计方法的枚举类型（平均值、中位数、最大值、最小值、其他）
- **管理员**：具有管理员权限的系统用户
- **末级节点**：评估模型树形结构中的叶子节点

## 需求

### 需求 1：导向规则管理

**用户故事**：作为管理员，我想要管理业务导向规则，以便定义不同类别的导向策略并应用到评估模型中。

#### 验收标准

1. WHEN 管理员访问导向规则管理页面 THEN 系统应显示所有导向规则的列表，包括ID、导向名称、导向类别和导向规则描述
2. WHEN 管理员创建新导向规则 THEN 系统应验证必填字段（导向名称、导向类别），并将导向规则描述限制在1024字符以内
3. WHEN 管理员编辑导向规则 THEN 系统应允许修改所有字段，并保持数据完整性
4. WHEN 管理员删除导向规则 THEN 系统应检查是否有模型节点关联该规则，若有则提示无法删除
5. WHEN 管理员查看"基准阶梯"类别的导向规则 THEN 系统应显示"设置基准"操作按钮
6. WHEN 管理员查看"基准阶梯"或"直接阶梯"类别的导向规则 THEN 系统应显示"设置阶梯"操作按钮

### 需求 2：导向规则复制功能

**用户故事**：作为管理员，我想要复制现有的导向规则及其关联数据，以便快速创建相似的导向配置。

#### 验收标准

1. WHEN 管理员选择复制导向规则 THEN 系统应创建新的导向规则记录，并自动在名称后添加"（副本）"标识
2. WHEN 系统复制"基准阶梯"类别的导向规则 THEN 系统应同时复制所有关联的导向基准记录
3. WHEN 系统复制"基准阶梯"或"直接阶梯"类别的导向规则 THEN 系统应同时复制所有关联的导向阶梯记录
4. WHEN 复制操作完成 THEN 系统应返回新创建的导向规则ID，并显示成功消息
5. WHEN 复制操作失败 THEN 系统应回滚所有已创建的记录，并显示错误消息

### 需求 3：导向规则导出功能

**用户故事**：作为管理员，我想要将导向规则导出为 Markdown 文档，以便进行文档化管理和分享。

#### 验收标准

1. WHEN 管理员选择导出导向规则 THEN 系统应生成包含导向规则详细信息的 Markdown 文件
2. WHEN 导出"基准阶梯"类别的导向规则 THEN 系统应在 Markdown 文件中包含所有关联的导向基准数据
3. WHEN 导出"基准阶梯"或"直接阶梯"类别的导向规则 THEN 系统应在 Markdown 文件中包含所有关联的导向阶梯数据
4. WHEN 导出文件生成 THEN 系统应使用导向名称作为文件名，并添加时间戳避免冲突
5. WHEN 导出文件下载 THEN 系统应正确处理中文文件名，确保跨平台兼容性

### 需求 4：导向基准管理

**用户故事**：作为管理员，我想要为"基准阶梯"类别的导向配置科室基准值，以便实现基于统计数据的动态调整。

#### 验收标准

1. WHEN 管理员访问导向基准管理页面 THEN 系统应显示所有导向基准的列表，包括所属导向名称、科室名称、基准类别、管控力度、统计时间范围和基准值
2. WHEN 管理员创建新导向基准 THEN 系统应验证所属导向为"基准阶梯"类别，并验证必填字段
3. WHEN 管理员输入管控力度或基准值 THEN 系统应自动格式化为小数点后4位
4. WHEN 管理员选择科室 THEN 系统应自动填充科室代码和科室名称
5. WHEN 管理员按导向筛选 THEN 系统应仅显示该导向关联的基准记录
6. WHEN 管理员从导向规则页面点击"设置基准" THEN 系统应跳转到导向基准管理页面，并自动选中该导向进行筛选

### 需求 5：导向阶梯管理

**用户故事**：作为管理员，我想要为导向配置分级阶梯，以便根据不同的数值区间应用不同的调整力度。

#### 验收标准

1. WHEN 管理员访问导向阶梯管理页面 THEN 系统应显示所有导向阶梯的列表，包括所属导向名称、阶梯次序、阶梯上限、阶梯下限和调整力度
2. WHEN 管理员创建新导向阶梯 THEN 系统应验证所属导向为"基准阶梯"或"直接阶梯"类别，并验证必填字段
3. WHEN 管理员输入阶梯上限、阶梯下限或调整力度 THEN 系统应自动格式化为小数点后4位
4. WHEN 管理员勾选"正无穷" THEN 系统应将阶梯上限设置为特殊值（如 NULL 或最大浮点数）
5. WHEN 管理员勾选"负无穷" THEN 系统应将阶梯下限设置为特殊值（如 NULL 或最小浮点数）
6. WHEN 管理员按导向筛选 THEN 系统应仅显示该导向关联的阶梯记录，并按阶梯次序排序
7. WHEN 管理员从导向规则页面点击"设置阶梯" THEN 系统应跳转到导向阶梯管理页面，并自动选中该导向进行筛选
8. WHEN 管理员保存阶梯配置 THEN 系统应验证同一导向下的阶梯次序唯一性

### 需求 6：模型节点业务导向关联

**用户故事**：作为管理员，我想要将模型末级节点的业务导向从文本升级为关联导向规则，以便实现结构化的导向管理。

#### 验收标准

1. WHEN 管理员编辑模型末级节点 THEN 系统应显示导向规则选择器，替代原有的文本输入框
2. WHEN 管理员选择导向规则 THEN 系统应保存导向规则ID到模型节点的业务导向字段
3. WHEN 管理员查看模型节点详情 THEN 系统应显示关联的导向规则名称
4. WHEN 系统迁移现有数据 THEN 系统应保留原有文本格式的业务导向数据，直到管理员手动更新
5. WHEN 管理员清空导向规则选择 THEN 系统应允许将业务导向字段设置为空

### 需求 7：多租户数据隔离

**用户故事**：作为系统架构师，我想要确保业务导向数据按医疗机构隔离，以便支持多租户部署。

#### 验收标准

1. WHEN 系统创建导向规则、导向基准或导向阶梯 THEN 系统应自动设置当前医疗机构ID
2. WHEN 系统查询导向数据 THEN 系统应仅返回当前医疗机构的数据
3. WHEN 系统执行复制或导出操作 THEN 系统应仅操作当前医疗机构的数据
4. WHEN 管理员切换医疗机构 THEN 系统应刷新页面数据，显示新医疗机构的导向配置

### 需求 8：数据完整性和验证

**用户故事**：作为系统管理员，我想要系统验证数据完整性，以便避免配置错误导致计算异常。

#### 验收标准

1. WHEN 管理员创建导向基准 THEN 系统应验证统计开始时间早于统计结束时间
2. WHEN 管理员创建导向阶梯 THEN 系统应验证阶梯下限小于阶梯上限（除非使用无穷值）
3. WHEN 管理员删除导向规则 THEN 系统应检查是否有关联的基准、阶梯或模型节点，并提示级联删除或阻止删除
4. WHEN 管理员修改导向类别 THEN 系统应验证现有关联数据的兼容性（如"其他"类别不应有基准或阶梯）
5. WHEN 系统保存数值字段 THEN 系统应验证数值格式正确，并自动四舍五入到指定精度
