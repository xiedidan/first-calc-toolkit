# 离线打包排除列表配置文件

## 文件说明

`.offline-package-exclude-tables.txt` 用于配置离线打包时不导出数据的表。

## 工作原理

- **列表中的表**：只导出表结构，不导出数据
- **其他所有表**：自动导出表结构和数据

## 文件格式

```txt
# 这是注释行，以 # 开头
# 空行会被忽略

table_name_1
table_name_2
table_name_3
```

### 规则

1. 每行一个表名
2. 以 `#` 开头的行为注释
3. 空行会被忽略
4. 表名前后的空格会被自动去除

## 使用场景

### 应该添加到排除列表的表

- 数据量大的表（数万~数百万行）
- 业务数据表（可以后续导入）
- 临时数据表
- 日志表

### 不应该添加到排除列表的表

- 配置表（用户、权限、设置等）
- 基础数据表（科室、收费项目等）
- 模型配置表（模型版本、节点等）
- 基准数据表（导向基准、成本基准等）

## 当前排除的表

| 表名 | 说明 | 典型数据量 |
|------|------|-----------|
| charge_details | 收费明细表 | 数十万~数百万行 |
| calculation_results | 计算结果表 | 数万~数十万行 |
| calculation_tasks | 计算任务表 | 数百~数千行 |
| orientation_adjustment_details | 导向调整明细表 | 数万~数十万行 |
| orientation_values | 导向实际值表 | 数千~数万行 |
| cost_values | 成本值表 | 数千~数万行 |
| department_revenues | 科室收入表 | 数千~数万行 |

## 修改方法

### 添加新表到排除列表

如果新增了一个大数据表 `new_large_table`：

```txt
# 在文件末尾添加
new_large_table
```

### 从排除列表移除表

如果某个表需要导出数据：

```txt
# 方法1: 删除该行
# 方法2: 注释该行
# charge_details
```

### 临时测试

可以临时注释某些表来测试：

```txt
# 临时导出 calculation_tasks 的数据
# calculation_tasks
```

## 验证配置

修改配置文件后，运行测试脚本验证：

```powershell
.\test-selective-export.ps1
```

输出示例：
```
Export Strategy:
  Exclude file: .offline-package-exclude-tables.txt
  Excluded tables (schema only): 7
  All other tables (with data): Auto-included

Excluded tables (schema only):
  - charge_details
  - calculation_results
  - ...
```

## 执行打包

```powershell
# Windows
.\scripts\build-offline-package.ps1

# Linux/WSL
bash scripts/build-offline-package.sh
```

## 注意事项

1. **不要删除此文件**：脚本依赖此文件运行
2. **表名必须准确**：拼写错误会导致表被正常导出
3. **提交到版本控制**：团队成员共享相同配置
4. **定期审查**：随着业务发展，调整排除列表

## 故障排除

### 问题：脚本报错找不到配置文件

**解决方案**：确保 `.offline-package-exclude-tables.txt` 文件在项目根目录

### 问题：某个表应该排除但还是导出了数据

**解决方案**：
1. 检查表名拼写是否正确
2. 确认表名前后没有多余空格
3. 确认该行没有被注释

### 问题：想要导出所有表的数据

**解决方案**：注释掉所有表名，或清空文件内容（保留注释）

## 相关文档

- `OFFLINE_PACKAGE_UPGRADE_SUMMARY.md` - 升级说明
- `OFFLINE_PACKAGE_OPTIMIZATION_SUMMARY.md` - 优化总结
- `scripts/build-offline-package.ps1` - PowerShell 打包脚本
- `scripts/build-offline-package.sh` - Bash 打包脚本
