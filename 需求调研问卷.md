# 需求调研问卷：医院科室业务价值评估工具

**说明**: 请您根据实际情况和期望，尽可能详细地回答以下问题。您的回答将作为项目需求分析和系统设计的核心依据。

---

### **第一部分：系统目标与用户**

1.  **核心目标**：除了评估科室业务价值，本工具是否还有其他核心目标？（例如：作为绩效考核的数据基础、支持资源分配决策、进行成本效益分析等）
    
    *您的回答*:没有其他目标，其实业务价值就是绩效，但是本工具内统一叫做业务价值。

2.  **用户角色**：请描述将使用本系统的不同用户角色及其主要职责。
    *   **模型设计者/管理员**：负责设计和维护评估模型（树状结构、权重、SQL）的人员？
        
        *您的回答*:负责设计和维护评估模型（树状结构、权重、SQL），系统相关配置。

    *   **数据分析师/操作员**：负责触发计算、查看和导出结果的人员？
        
        *您的回答*:负责触发计算、查看和导出结果、调整权重、确认数据口径。

    *   **科室管理者/院领导**：只读访问，查看本科室或全院的评估结果？
        
        *您的回答*:只读访问，查看本科室或全院的评估结果。

    *   **其他角色**？
        
        *您的回答*:业务专家：查看和调整模型、权重、触发计算、导出结果，不涉及SQL实现。

---

### **第二部分：数据与计算**

3.  **上游数据源**：
    *   数据是存储在单个数据库中，还是多个数据库？
        
        *您的回答*:单个数据库的单个Schema内，多张表。

    *   我们是否可以假定在执行SQL查询时，系统账户具有对相关数据表的只读权限？
        
        *您的回答*:可读写。

    *   能否提供一些关键数据表的表名和字段示例？（例如，包含科室ID、医生ID、收费项目、时间戳等的表）
        
        *您的回答*:
        字段名都是拼音首字母
        这是DWD的收费明细表：
        ```sql
        CREATE TABLE "public"."dwd_sfmxb" (
            "sj" timestamp(6),
            "io_flg" text COLLATE "pg_catalog"."default",
            "blid" varchar COLLATE "pg_catalog"."default",
            "kbcs" int4,
            "fy" "pg_catalog"."numeric",
            "dw" varchar COLLATE "pg_catalog"."default",
            "sfmc" varchar COLLATE "pg_catalog"."default",
            "sfbm" varchar COLLATE "pg_catalog"."default",
            "gg" varchar COLLATE "pg_catalog"."default",
            "sflb" varchar COLLATE "pg_catalog"."default",
            "kdksid" varchar COLLATE "pg_catalog"."default",
            "kdryid" varchar COLLATE "pg_catalog"."default",
            "zxksid" varchar COLLATE "pg_catalog"."default",
            "zxryid" varchar COLLATE "pg_catalog"."default",
            "zyksid" varchar COLLATE "pg_catalog"."default",
            "zxysksid" varchar COLLATE "pg_catalog"."default",
            "bqzxhsksid" varchar COLLATE "pg_catalog"."default",
            "fbqzxhsksid" varchar COLLATE "pg_catalog"."default",
            "zxjsksid" varchar COLLATE "pg_catalog"."default",
            "kdrymc" varchar COLLATE "pg_catalog"."default",
            "zxrymc" varchar COLLATE "pg_catalog"."default"
        );
        ```
        科室代码对照表：
        ```sql
        CREATE TABLE "public"."dim_ksdmdzb" (
            "seq_id" text COLLATE "pg_catalog"."default",
            "hisksdm" text COLLATE "pg_catalog"."default",
            "hisksmc" text COLLATE "pg_catalog"."default",
            "cbzxdm" text COLLATE "pg_catalog"."default",
            "cbzxmc" text COLLATE "pg_catalog"."default",
            "cbzxlb" text COLLATE "pg_catalog"."default",
            "gsksdm" text COLLATE "pg_catalog"."default",
            "gsksmc" text COLLATE "pg_catalog"."default",
            "hiskslx" text COLLATE "pg_catalog"."default",
            "hisksnwkbs" text COLLATE "pg_catalog"."default",
            "hrphsdydm" text COLLATE "pg_catalog"."default",
            "hrphsdymc" text COLLATE "pg_catalog"."default",
            "hsdydm" text COLLATE "pg_catalog"."default",
            "hsdymc" text COLLATE "pg_catalog"."default",
            "is_leaf" text COLLATE "pg_catalog"."default",
            "baksdm" text COLLATE "pg_catalog"."default",
            "baksmc" text COLLATE "pg_catalog"."default",
            "hisksbqbs" text COLLATE "pg_catalog"."default",
            "bbzsmc" text COLLATE "pg_catalog"."default",
            "yjptkslbbm" text COLLATE "pg_catalog"."default",
            "yjptkslbmc" text COLLATE "pg_catalog"."default",
            "hsdynwkbs" varchar COLLATE "pg_catalog"."default",
            "created_at" timestamp(6),
            "updated_at" timestamp(6),
            "is_outpatient" bool,
            "is_inpatient" bool,
            "is_icu" bool,
            "comment" varchar(255) COLLATE "pg_catalog"."default",
            "yjcbzxdm" varchar(255) COLLATE "pg_catalog"."default",
            "yjcbzxmc" varchar(255) COLLATE "pg_catalog"."default"
        );
        ```

4.  **计算逻辑细节**：
    *   **动态参数**：维度SQL在执行时，是否需要传入动态参数？最常见的参数是什么？（例如：`{科室ID}`, `{开始日期}`, `{结束日期}`）
        
        *您的回答*:是的，主要是当期年月（价值是按月计算的），科室倒不用，一般是groupby科室的。

    *   **SQL复杂度**：维度的SQL查询通常有多复杂？是简单的`SELECT COUNT(*) ...`，还是包含多表JOIN、子查询、窗口函数的复杂查询？
        
        *您的回答*:复杂查询。

    *   **Python处理**：在什么情况下需要用Python代码进行处理？（例如：SQL无法实现某些逻辑、需要调用外部API、对多个SQL结果进行复杂运算等）
        
        *您的回答*:SQL有些运算实现比较复杂，还有生成Excel报表之类的，也有可能调用AI进行SQL语句检查和推断。

    *   **权重结构**：权重是应用在每个叶子节点（维度）上，还是在树的每个层级（序列、子序列）上都有？（例如，一个序列的总分是其下所有维度“加权得分”的总和吗？）
        
        *您的回答*:只有叶子上应用权重。

    *   **计算触发**：计算任务是如何触发的？（请勾选）
        *   [x] 手动点击按钮，选择科室和月份进行计算。
        *   [ ] 系统按固定周期自动计算（例如，每月5号自动计算上个月的数据）。
        *   [ ] 两者都需要。
        
        *您的说明*:手动触发就行，最好能够在一个地方设好当期年月，然后整个工具里面固定下来。

5.  **结果数据**：
    *   计算结果需要存回PG数据库的哪个表中？是新建一个表还是写入现有表？
        
        *您的回答*:新建表。

    *   结果表需要存储哪些信息？我们设想至少包含：`计算任务ID`, `科室ID`, `评估月份`, `维度名称`, `维度工作量`, `维度权重`, `维度得分`, `总分`。是否需要更详细的中间过程数据？
        
        *您的回答*:我已经在项目目录下放置《绩效结构表（模板）-标准版-20251017-v1.xlsx》文件，这就是最终输出的模板，供参考。

    *   对于历史计算结果，是保留所有版本的计算，还是新计算会覆盖旧的？
        
        *您的回答*:保留所有版本，可以选中一个版本作为最终版。

---

### **第三部分：功能与界面**

6.  **评估模型管理 (树状结构编辑器)**：
    *   **版本控制**：评估模型（树、权重、SQL）是否需要版本控制？例如，2024年和2025年的评估模型可能不同，系统需要能够保存和切换不同版本的模型进行计算或回溯。
        
        *您的回答*:需要。

    *   **操作体验**：对于树状结构的编辑，您期望是怎样的体验？（例如：拖拽调整节点顺序和层级、右键菜单进行增删改、在一个表单中编辑节点属性如名称/SQL/权重等）
        
        *您的回答*:用类似于Excel的表格格式就行，不讲究特别炫酷，简单实用就可以，树状结构可以参考项目目录下《绩效结构表（模板）-标准版-20251017-v1.xlsx》。

    *   **SQL编辑器**：在界面上编辑SQL时，是否需要语法高亮、自动补全或SQL格式化等辅助功能？是否需要一个“测试运行”按钮来验证SQL的正确性并预览结果？
        
        *您的回答*:1.编辑辅助功能需要，但是优先级不高；2.需要。

7.  **结果展示**：
    *   用户是否需要在界面上直接查看计算结果？
        
        *您的回答*:需要。

    *   您期望结果以什么形式展示？（例如：显示各科室总分的排名列表、点击科室可查看其下各序列/维度的得分详情、提供图表进行可视化对比等）
        
        *您的回答*:1.最重要的是各科室的绩效结构表；2.其次需要做一张科室汇总表（包含科室、医生价值、医生占比、护理价值、护理占比、医技价值、医技占比、科室总价值、诊断收入、执行收入、门急诊数量、占用床日数，以及全院的汇总）。

    *   是否需要结果导出功能？如果需要，期望的格式是什么？（Excel, CSV）
        
        *您的回答*:需要，Excel，按照《绩效结构表（模板）-标准版-20251017-v1.xlsx》，以及上一个问题中，我们设计的科室业务价值汇总表。  

---

### **第四部分：非功能性需求**

8.  **性能**：
    *   一次完整的计算（例如，计算全院所有科室一个月的价值）预计需要多长时间完成？您能接受的最大时长是多久？
        
        *您的回答*:没有上限，但是中型医院（10-20个科室，每月100万条收费明细）希望单次完整计算在1小时内完成。

    *   上游数据量有多大？（例如，每月新增的记录数在什么量级？）
        
        *您的回答*:中型医院在每月100万条收费明细，大型医院在每月1000万条收费明细左右。收费明细是最大的数据表。

9.  **安全性**：
    *   用户登录系统是否需要与医院现有的统一认证系统（如LDAP/AD）集成？
        
        *您的回答*:不用。

    *   不同角色的用户访问数据权限需要严格隔离吗？（例如，A科室主任不能看到B科室的详细得分构成）
        
        *您的回答*:是的，权限主要就是管控科室之间不能互相看。

---

### **第五部分：新增需求 - 维度目录管理**

10. **维度目录管理**：
    *   **目录形式**：您期望的“维度-收费项目”对照目录是以什么形式管理的？（例如：一个独立的配置界面，允许为每个维度勾选或关联多个收费项目代码？）
        
        *您的回答*:独立列表界面，为每个维度配置多个收费项目（以代码为唯一识别符）。

    *   **收费项目来源**：收费项目的列表（如项目代码、项目名称）是从哪个数据库表来的？是 `dwd_sfmxb` 表中的 `sfbm` (收费编码) 和 `sfmc` (收费名称) 吗？是否需要支持模糊搜索来快速找到项目？
        
        *您的回答*:dim_sfxmb，收费项目表。结构：
        ```sql
        CREATE TABLE "public"."dim_sfxmb" (
            "sfxmbm" varchar COLLATE "pg_catalog"."default",
            "sfxmmc" varchar COLLATE "pg_catalog"."default",
            "ggxh" varchar COLLATE "pg_catalog"."default",
            "dw" varchar COLLATE "pg_catalog"."default",
            "dj" "pg_catalog"."numeric",
            "wbj" "pg_catalog"."numeric",
            "sflb" varchar COLLATE "pg_catalog"."default",
            "tag" varchar COLLATE "pg_catalog"."default",
            "id" int4 NOT NULL DEFAULT nextval('dim_sfxmb_id_seq'::regclass),
            CONSTRAINT "dim_sfxmb_pkey" PRIMARY KEY ("id")
        );
        ```
    *   **维度类型**：您提到“绝大多数末级维度通过维度-收费项目对照目录统计，少部分通过指标计算”。系统是否需要明确区分这两种类型的维度？
        *   **统计型维度**：通过关联的收费项目列表，使用 `COUNT(*)` 或 `SUM(fy)` 等聚合函数统计。
        *   **计算型维度**：直接通过您之前提到的复杂SQL或Python脚本进行计算。
        
        *您的回答*:你提的两种都有，但我认为用SQL或者Python代码表示就可以了，系统可以弄一个选项进行标记（但不影响或检查具体统计逻辑）。

    *   **目录的复用**：同一个收费项目目录是否可以被多个不同的维度引用？还是每个维度都有自己独立的目录？
        
        *您的回答*:每个按项目目录计算的末级维度，都有自己的独立的目录。

    *   **目录的导入导出**：是否需要支持维度目录的批量导入（例如，从Excel导入维度与收费项目的对应关系）和导出功能？
        
        *您的回答*:需要的，可能会把多个维度合并到一起用一个文件导入，比如所有的手术目录、所有的治疗手术目录一起导入。