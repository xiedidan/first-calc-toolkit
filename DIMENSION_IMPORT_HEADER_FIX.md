# 维度目录导入 - 表头显示优化

## 📋 问题描述

之前的实现中，当Excel表头单元格为空时，系统会自动生成"列1"、"列2"这样的默认名称，导致用户无法看到Excel中的实际列名。

## ✅ 解决方案

### 1. 表头格式优化

现在表头会显示为以下格式：

**有内容的列**：
```
收费编码 (A)
收费名称 (B)
维度预案 (C)
专家意见 (D)
```

**空列**：
```
(空列-E)
(空列-F)
```

### 2. 实现细节

#### 后端实现
```python
def get_excel_column_name(col_index):
    """将列索引转换为Excel列名（A, B, C, ..., Z, AA, AB, ...）"""
    result = ""
    while col_index >= 0:
        result = chr(col_index % 26 + 65) + result
        col_index = col_index // 26 - 1
    return result

headers = []
for i, cell in enumerate(rows[0]):
    col_name = get_excel_column_name(i)
    if cell is not None and str(cell).strip():
        # 格式：列名 (Excel列)
        headers.append(f"{str(cell).strip()} ({col_name})")
    else:
        # 格式：(空列-Excel列)
        headers.append(f"(空列-{col_name})")
```

## 🎯 用户体验提升

### 场景1：标准Excel文件
```
Excel表头（第1行）：
A列: 收费编码
B列: 收费名称
C列: 维度预案
D列: 专家意见

系统显示：
- 收费编码 (A)
- 收费名称 (B)
- 维度预案 (C)
- 专家意见 (D)
```

### 场景2：包含空列的Excel
```
Excel表头（第1行）：
A列: 收费编码
B列: 收费名称
C列: (空)
D列: 维度预案
E列: (空)
F列: 专家意见

系统显示：
- 收费编码 (A)
- 收费名称 (B)
- (空列-C)
- 维度预案 (D)
- (空列-E)
- 专家意见 (F)
```

### 场景3：跳过前3行后
```
Excel文件：
第1行: 医院名称        ← 跳过
第2行: 报表标题        ← 跳过
第3行: 生成日期        ← 跳过
第4行: A列:收费编码 | B列:收费名称 | C列:维度预案  ← 表头

系统显示：
- 收费编码 (A)
- 收费名称 (B)
- 维度预案 (C)
```

## 💡 优势

1. **清晰的列标识**：用户可以看到Excel中的实际列标识（A、B、C等）
2. **内容可见**：显示单元格的实际内容
3. **空列识别**：明确标记空列，避免混淆
4. **便于对照**：用户可以轻松对照Excel文件验证
5. **国际化友好**：使用Excel标准的列标识（A-Z, AA-ZZ等）

## 📊 字段映射界面效果

### 字段映射配置
```
收费编码: [下拉选择]
  - 收费编码 (A)
  - 收费名称 (B)
  - (空列-C)
  - 维度预案 (D)
  - 专家意见 (E)

维度预案: [下拉选择]
  - 收费编码 (A)
  - 收费名称 (B)
  - (空列-C)
  - 维度预案 (D)  ← 建议选择
  - 专家意见 (E)

专家意见: [下拉选择]
  - 收费编码 (A)
  - 收费名称 (B)
  - (空列-C)
  - 维度预案 (D)
  - 专家意见 (E)  ← 建议选择
```

## 🔄 数据预览表格

表格表头也会显示相同的格式：

```
| 行号 | 收费编码 (A) | 收费名称 (B) | 维度预案 (D) | 专家意见 (E) |
|------|-------------|-------------|-------------|-------------|
|  2   | CK001       | 血常规       | 检验项目     | 4D          |
|  3   | CK002       | 尿常规       | 检验项目     |             |
```

## ⚠️ 注意事项

1. **Excel列名生成**：
   - A-Z：单字母列（0-25）
   - AA-AZ：双字母列（26-51）
   - BA-ZZ：继续递增
   - 算法支持任意多列

2. **空列处理**：
   - 空列会被标记为 `(空列-X)`
   - 用户可以选择忽略空列
   - 空列不会影响导入功能

3. **字符处理**：
   - 自动去除前后空格
   - 保留单元格的实际内容
   - 支持中文、英文、数字等

## 🧪 测试建议

### 测试用例1：标准表头
- 所有列都有名称
- 验证显示格式正确

### 测试用例2：包含空列
- 部分列为空
- 验证空列标记正确

### 测试用例3：大量列
- 超过26列（需要AA、AB等）
- 验证列名生成正确

### 测试用例4：特殊字符
- 表头包含特殊字符
- 验证字符处理正确

## ✨ 总结

本次优化解决了表头显示不清晰的问题：
- ✅ 显示Excel实际列名（A、B、C等）
- ✅ 显示单元格实际内容
- ✅ 明确标记空列
- ✅ 便于用户对照验证
- ✅ 提升导入准确性

用户现在可以清楚地看到每一列在Excel中的位置和内容，大大提升了导入的可靠性和用户体验！
