# 汇总表导出功能测试清单

## 快速测试步骤

### 1. 测试Excel生成（离线测试）

```bash
# 运行测试脚本
test-export-summary.bat
```

**预期结果**：
- ✅ 生成文件：`科室业务价值汇总_2025-10_测试.xlsx`
- ✅ 文件大小：约5-6KB
- ✅ 可以正常打开

### 2. 检查Excel内容

打开生成的Excel文件，逐项检查：

#### 标题和表头
- [ ] 第1行：标题"科室业务价值汇总（2025-10）"，合并单元格，居中，14号字
- [ ] 第2行：序列分组表头（科室、医生序列、护理序列、医技序列、科室总价值）
- [ ] 第3行：价值/占比子表头
- [ ] 表头背景：蓝色（#4472C4）
- [ ] 表头字体：白色，加粗

#### 数据行
- [ ] 第4行：全院汇总，加粗，灰色背景
- [ ] 第5-7行：3个科室数据
- [ ] 所有单元格有边框

#### 数据格式
- [ ] 科室列（A列）：左对齐
- [ ] 价值列（B/D/F/H列）：右对齐，千分位，2位小数
  - 示例：1,500,000.50
- [ ] 占比列（C/E/G列）：居中，百分比格式
  - 示例：45.50%

#### 数据准确性
- [ ] 全院汇总医生价值 = 1,500,000.50
- [ ] 全院汇总护理价值 = 1,000,000.30
- [ ] 全院汇总医技价值 = 800,000.20
- [ ] 全院汇总总价值 = 3,300,000.00
- [ ] 内科总价值 = 1,000,000.00
- [ ] 外科总价值 = 1,250,000.00
- [ ] 儿科总价值 = 1,050,000.00

### 3. 测试API接口（需要后端运行）

#### 启动后端
```bash
cd backend
uvicorn app.main:app --reload
```

#### 测试接口
```bash
# 方法1：使用curl（需要先登录获取token）
curl -X GET "http://localhost:8000/calculation/results/export/summary?period=2025-10" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  --output 汇总表.xlsx

# 方法2：使用浏览器
# 访问：http://localhost:8000/docs
# 找到 /calculation/results/export/summary 接口
# 点击 "Try it out"
# 输入参数，点击 "Execute"
```

**预期结果**：
- [ ] 返回状态码：200
- [ ] Content-Type：application/vnd.openxmlformats-officedocument.spreadsheetml.sheet
- [ ] 文件可以正常下载和打开

### 4. 测试前端功能（需要前后端都运行）

#### 启动服务
```bash
# 终端1：后端
cd backend
uvicorn app.main:app --reload

# 终端2：前端
cd frontend
npm run dev
```

#### 测试步骤
1. [ ] 访问：http://localhost:3000
2. [ ] 登录系统
3. [ ] 进入"评估结果"页面
4. [ ] 选择评估月份（如：2025-10）
5. [ ] 点击"导出汇总表"按钮
6. [ ] 浏览器自动下载Excel文件
7. [ ] 文件名格式：`科室业务价值汇总_2025-10.xlsx`
8. [ ] 打开文件，检查内容正确

**预期结果**：
- [ ] 点击按钮后显示"导出中"状态
- [ ] 1-2秒后显示"导出成功"提示
- [ ] 浏览器下载栏出现文件
- [ ] 文件可以正常打开
- [ ] 数据与页面显示一致

## 边界情况测试

### 1. 无数据情况
- [ ] 选择没有数据的月份
- [ ] 预期：提示"未找到计算结果"

### 2. 单个科室
- [ ] 只有1个科室的数据
- [ ] 预期：正常导出，只有全院汇总和1个科室

### 3. 大量科室
- [ ] 50+个科室
- [ ] 预期：正常导出，所有科室都显示

### 4. 特殊字符
- [ ] 科室名称包含特殊字符（如：&、<、>）
- [ ] 预期：正常显示，不乱码

### 5. 零值数据
- [ ] 某个序列价值为0
- [ ] 预期：显示0.00，占比0.00%

## 性能测试

### 小数据量（< 10个科室）
- [ ] 响应时间 < 1秒
- [ ] 文件大小 < 10KB

### 中等数据量（10-50个科室）
- [ ] 响应时间 < 3秒
- [ ] 文件大小 < 50KB

### 大数据量（50-100个科室）
- [ ] 响应时间 < 10秒
- [ ] 文件大小 < 100KB

## 兼容性测试

### 浏览器
- [ ] Chrome
- [ ] Firefox
- [ ] Edge
- [ ] Safari

### Excel版本
- [ ] Excel 2016+
- [ ] WPS Office
- [ ] LibreOffice Calc
- [ ] Google Sheets（上传后查看）

## 问题记录

如果测试中发现问题，记录在此：

### 问题1
- **现象**：
- **重现步骤**：
- **预期结果**：
- **实际结果**：
- **解决方案**：

### 问题2
- **现象**：
- **重现步骤**：
- **预期结果**：
- **实际结果**：
- **解决方案**：

## 测试结论

- [ ] 所有测试通过
- [ ] 功能正常可用
- [ ] 可以发布到生产环境

**测试人员**：__________  
**测试日期**：__________  
**测试环境**：__________  

## 备注

其他需要说明的内容：
