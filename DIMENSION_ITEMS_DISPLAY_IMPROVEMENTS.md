# 维度目录管理 - 显示优化

## 更新日期
2025-10-24

## 更新内容

### 1. 模型版本显示优化 ⭐

#### 之前
只显示版本名称：
```
[2024年绩效考核模型 ▼]
```

#### 现在
同时显示版本号和名称：
```
[V1 - 2024年绩效考核模型 ▼]
[V2 - 2025年绩效考核模型 ▼]
```

**优势**：
- 更清晰地区分不同版本
- 版本号一目了然
- 便于快速识别和选择

### 2. 维度选择支持多选 ⭐

#### 之前
只能选择一个维度：
```
维度: [医疗服务 > 检查 > CT检查 ▼]
```

#### 现在
支持选择多个维度：
```
维度: [医疗服务 > 检查 > CT检查, 医疗服务 > 检查 > MRI检查 ▼]
```

**功能特点**：
- 支持多选维度
- 使用折叠标签显示（collapse-tags）
- 鼠标悬停显示所有选中项（collapse-tags-tooltip）
- 一次查询多个维度的收费项目

**使用场景**：
- 对比多个维度的收费项目
- 批量查看相关维度
- 统计多个维度的项目数量

### 3. 表格占满整个宽度 ⭐

#### 之前
表格只占一半宽度，右侧有大量空白

#### 现在
表格占满整个主内容区域

**优势**：
- 更好的视觉效果
- 充分利用屏幕空间
- 可以显示更多列信息
- 提升用户体验

## 技术实现

### 1. 模型版本显示

```vue
<el-option
  v-for="version in modelVersions"
  :key="version.id"
  :label="`V${version.version} - ${version.name}`"
  :value="version.id"
/>
```

### 2. 维度多选

#### 前端实现

```vue
<el-select
  v-model="dimensionIds"
  placeholder="请选择维度（可多选）"
  multiple
  clearable
  filterable
  collapse-tags
  collapse-tags-tooltip
  style="width: 400px"
>
  <el-option
    v-for="dim in leafDimensions"
    :key="dim.id"
    :label="dim.full_path"
    :value="dim.id"
  />
</el-select>
```

```typescript
// 改为数组
const dimensionIds = ref<number[]>([])

// 查询时传递多个ID
const params: any = {
  dimension_ids: dimensionIds.value.join(',')
}
```

#### 后端实现

```python
@router.get("", response_model=DimensionItemList)
def get_dimension_items(
    dimension_id: Optional[int] = Query(None, description="维度节点ID（单个）"),
    dimension_ids: Optional[str] = Query(None, description="维度节点ID列表（逗号分隔）"),
    ...
):
    # 支持多个维度ID
    if dimension_ids:
        id_list = [int(id.strip()) for id in dimension_ids.split(',') if id.strip()]
        if id_list:
            query = query.filter(DimensionItemMapping.dimension_id.in_(id_list))
    elif dimension_id is not None:
        # 向后兼容单个ID
        query = query.filter(DimensionItemMapping.dimension_id == dimension_id)
```

### 3. 表格宽度优化

```css
.dimension-items-container {
  padding: 0;
  width: 100%;
  height: 100%;
}

.dimension-items-container :deep(.el-card) {
  width: 100%;
  height: 100%;
}

.dimension-items-container :deep(.el-card__body) {
  height: calc(100% - 60px);
  display: flex;
  flex-direction: column;
}

.dimension-items-container :deep(.el-table) {
  flex: 1;
}
```

## 使用说明

### 1. 查看单个维度

```
1. 选择模型版本：V1 - 2024年绩效考核模型
2. 选择维度：医疗服务 > 检查 > CT检查
3. 点击"查询"
```

### 2. 查看多个维度

```
1. 选择模型版本：V1 - 2024年绩效考核模型
2. 选择多个维度：
   - 医疗服务 > 检查 > CT检查
   - 医疗服务 > 检查 > MRI检查
   - 医疗服务 > 检查 > 超声检查
3. 点击"查询"
4. 表格显示所有选中维度的收费项目
```

### 3. 操作限制

某些操作只能在选择单个维度时进行：

#### 添加收费项目
```
✅ 选择1个维度 → 可以添加
❌ 选择多个维度 → 提示"添加收费项目时只能选择一个维度"
```

#### 全部清除
```
✅ 选择1个维度 → 可以清空
❌ 选择多个维度 → 提示"清空操作只能选择一个维度"
```

#### 查询和删除
```
✅ 选择多个维度 → 可以查询和删除单个项目
```

## 界面展示

### 优化前
```
┌────────────────────────────────────────┐
│ 模型版本: [2024年模型 ▼]               │
│ 维度: [CT检查 ▼]                       │
├────────────────────────────────────────┤
│ 表格（只占一半宽度）                    │
│                                        │
│                        （大量空白）     │
└────────────────────────────────────────┘
```

### 优化后
```
┌──────────────────────────────────────────────────────────────┐
│ 模型版本: [V1 - 2024年模型 ▼]                                │
│ 维度: [CT检查, MRI检查, 超声检查 ▼]                          │
├──────────────────────────────────────────────────────────────┤
│ 表格（占满整个宽度）                                          │
│ 收费编码 | 收费名称 | 项目分类 | 维度ID | 添加时间 | 操作    │
│ CT001   | CT检查   | 检查     | 10     | 2024-10  | [删除]  │
│ MRI002  | MRI检查  | 检查     | 11     | 2024-10  | [删除]  │
└──────────────────────────────────────────────────────────────┘
```

## 使用场景

### 场景1：对比不同维度的项目

```
需求：查看CT检查、MRI检查、超声检查三个维度的收费项目

操作：
1. 选择模型版本
2. 多选这三个维度
3. 点击查询
4. 表格显示所有项目，维度ID列显示每个项目属于哪个维度
```

### 场景2：统计多个维度的项目数量

```
需求：统计所有检查类维度的项目总数

操作：
1. 选择模型版本
2. 多选所有检查类维度
3. 点击查询
4. 查看分页器显示的总数
```

### 场景3：批量查看相关维度

```
需求：查看某个科室相关的所有维度

操作：
1. 选择模型版本
2. 在维度下拉框中搜索科室名称
3. 多选相关维度
4. 点击查询
```

## 注意事项

### 1. 多选维度的限制

- **添加收费项目**：只能选择一个维度
- **全部清除**：只能选择一个维度
- **查询**：可以选择多个维度
- **删除单个项目**：可以选择多个维度

### 2. 性能考虑

- 建议一次不要选择太多维度（建议不超过10个）
- 如果选择过多维度，查询可能会较慢
- 可以使用关键词搜索来缩小结果范围

### 3. 表格显示

- 多选维度时，表格会显示"维度ID"列
- 可以通过维度ID区分不同维度的项目
- 支持按维度ID排序

## 优势对比

| 特性 | 之前 | 现在 |
|------|------|------|
| 版本显示 | 只有名称 | 版本号 + 名称 |
| 维度选择 | 单选 | 多选 |
| 表格宽度 | 50% | 100% |
| 对比维度 | 需要多次查询 | 一次查询 |
| 用户体验 | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ |

## 常见问题

### Q: 为什么添加收费项目时不能多选维度？
A: 添加操作需要指定具体的维度ID，多选会导致逻辑混乱。如果需要为多个维度添加相同的项目，可以使用智能导入功能。

### Q: 多选维度后，如何知道每个项目属于哪个维度？
A: 表格中的"维度ID"列会显示每个项目所属的维度ID。

### Q: 可以一次选择所有维度吗？
A: 技术上可以，但不建议。选择太多维度会影响性能，建议一次不超过10个。

### Q: 表格为什么占满整个宽度？
A: 为了更好地利用屏幕空间，提供更好的视觉效果。如果觉得太宽，可以调整浏览器窗口大小。

### Q: 版本号是从哪里来的？
A: 版本号是模型版本的 `version` 字段，在创建模型版本时设置。

## 相关文档

- [维度目录管理快速指南](DIMENSION_ITEMS_QUICK_GUIDE.md)
- [界面优化更新](DIMENSION_ITEMS_UI_UPDATE.md)
- [智能导入完整文档](DIMENSION_SMART_IMPORT_COMPLETED.md)

## 更新历史

- 2025-10-24: 初始版本
  - 模型版本显示版本号和名称
  - 维度选择支持多选
  - 表格占满整个宽度
