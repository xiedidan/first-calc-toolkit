# 模型版本导入功能 - 用户操作指南

## 功能简介

模型版本导入功能允许您从系统中其他医疗机构的模型版本中导入结构和配置到当前医疗机构，帮助您快速复制现有知识，提高模型复用性。

## 适用场景

- **跨机构知识共享**：医疗集团内部不同医院可以共享评估模型
- **快速启动**：新医院可以导入成熟医院的模型版本，快速开始使用
- **模型优化参考**：可以导入其他医院的优秀模型作为参考，进行本地化调整

## 操作步骤

### 步骤1：打开导入功能

1. 登录系统后，进入"评估模型管理"页面
2. 点击页面右上角的"导入版本"按钮（绿色按钮）
3. 系统将打开导入向导对话框

### 步骤2：选择要导入的版本

1. 在导入向导的第一步，您将看到可导入的模型版本列表
2. 列表显示其他医疗机构的所有模型版本，包括：
   - 版本号
   - 版本名称
   - 所属医疗机构名称
   - 创建时间

3. **搜索版本**（可选）：
   - 在搜索框中输入关键词（版本号、名称或医疗机构名称）
   - 系统将自动过滤匹配的版本

4. **选择版本**：
   - 点击表格中的某一行，该行将高亮显示
   - 确认选择后，点击"下一步"按钮

### 步骤3：预览版本详情

1. 在第二步，系统将显示所选版本的详细信息：
   - **基本信息**：版本号、版本名称、所属医疗机构、版本描述
   - **统计信息**：
     - 模型节点数量：该版本包含的所有节点数
     - 计算流程数量：该版本关联的计算流程数
     - 计算步骤数量：所有流程中的计算步骤总数

2. 仔细查看这些信息，确认是否符合您的需求
3. 确认无误后，点击"下一步"按钮

### 步骤4：配置导入选项

1. **选择导入类型**：
   - **仅导入模型结构**：只复制模型的节点树结构（推荐新手使用）
   - **导入模型结构和计算流程**：同时复制节点和计算流程（包含SQL/Python代码）
   
   ⚠️ **重要提示**：如果选择导入计算流程，系统会显示警告："计算流程中的SQL代码可能需要根据您的数据库结构进行调整"。导入后请检查并调整SQL代码。

2. **配置新版本信息**：
   - **版本号**（必填）：
     - 输入新版本的版本号
     - 系统会自动检查版本号是否已存在
     - 如果版本号重复，会显示警告提示
   
   - **版本名称**（必填）：
     - 输入新版本的名称
     - 建议使用描述性名称，如"2025年标准版（从XX医院导入）"
   
   - **版本描述**（可选）：
     - 输入版本的详细描述
     - 建议记录导入来源和用途

3. 填写完成后，点击"确认导入"按钮

### 步骤5：查看导入结果

1. 系统开始执行导入操作，会显示加载状态
2. 导入完成后，系统将显示导入结果：
   - **新版本信息**：版本号、版本名称
   - **导入统计**：
     - 导入的节点数量
     - 导入的流程数量
     - 导入的步骤数量
   
   - **警告信息**（如果有）：
     - 例如："计算步骤 'XXX' 引用的数据源在目标医疗机构不存在，已设置为使用默认数据源"
     - 请仔细阅读警告信息，并在后续使用中注意调整

3. **查看新版本**：
   - 点击"查看新版本"按钮，跳转到新版本的详情页面
   - 或点击"完成"按钮，返回模型版本列表

4. **后续操作**：
   - 新导入的版本默认为"未激活"状态
   - 您可以在版本列表中找到新版本
   - 可以编辑结构、查看规则、激活版本等

## 注意事项

### 1. 权限要求
- 只有"模型设计师"和"系统管理员"角色可以执行导入操作
- 您只能导入到自己所属的医疗机构

### 2. 导入内容说明
- **会导入**：
  - 模型节点（完整的树状结构）
  - 计算流程和步骤（如果选择）
  
- **不会导入**：
  - 维度目录映射（收费项目与医疗机构相关）
  - 计算结果数据
  - 版本的激活状态

### 3. 数据独立性
- 导入后的版本与源版本完全独立
- 您对导入版本的任何修改都不会影响源版本
- 源医疗机构对其版本的修改也不会影响您导入的版本

### 4. 数据源引用处理
- 如果导入的计算流程中引用了数据源，系统会检查该数据源是否在您的医疗机构中存在
- 如果不存在，系统会自动将引用设为NULL（使用默认数据源）
- 这种情况会在导入结果中显示警告
- 建议导入后检查计算流程，确保数据源配置正确

### 5. SQL代码调整
- 如果导入了计算流程，其中的SQL代码可能需要根据您的数据库结构进行调整
- 建议导入后：
  1. 进入计算流程管理页面
  2. 查看每个计算步骤的SQL代码
  3. 使用"测试运行"功能验证代码是否正常
  4. 根据实际情况调整SQL代码

### 6. 版本号管理
- 版本号在同一医疗机构内必须唯一
- 建议使用有意义的版本号，如：
  - `v1.0-imported` - 表示导入的版本
  - `v1.0-from-hospital-a` - 表示从A医院导入
  - `v2.0-optimized` - 表示优化后的版本

## 常见问题

### Q1：为什么看不到某些医院的模型版本？
**A**：可导入版本列表只显示其他医疗机构的版本，不包括您当前所属医疗机构的版本。如果您想复制本机构的版本，请使用"复制"功能。

### Q2：导入失败怎么办？
**A**：导入失败可能的原因：
- 版本号已存在：请更换一个唯一的版本号
- 网络问题：请检查网络连接后重试
- 权限不足：请联系管理员确认您的角色权限
- 系统错误：请联系技术支持

导入操作具有原子性，失败时会自动回滚，不会产生不完整的数据。

### Q3：导入后可以修改吗？
**A**：可以。导入后的版本与本地创建的版本功能完全相同，您可以：
- 编辑模型结构
- 修改节点属性
- 添加或删除计算流程
- 激活或删除版本

### Q4：导入的版本会自动激活吗？
**A**：不会。新导入的版本默认为"未激活"状态。您需要在确认版本无误后，手动激活该版本。

### Q5：可以导入多次吗？
**A**：可以。您可以多次导入同一个源版本，只需使用不同的版本号即可。每次导入都会创建一个独立的新版本。

### Q6：导入需要多长时间？
**A**：导入时间取决于模型的规模：
- 小型模型（20-50个节点）：通常在10秒内完成
- 中型模型（50-100个节点）：通常在30秒内完成
- 大型模型（100-200个节点，含流程）：可能需要1-2分钟

### Q7：导入后如何查看导入历史？
**A**：目前系统记录了导入历史，但暂不提供查询界面。如需查看导入来源，可以在版本描述中记录相关信息。

## 最佳实践

1. **导入前充分了解源版本**：
   - 仔细查看预览信息
   - 了解源医院的业务特点
   - 评估是否适合本机构使用

2. **选择合适的导入类型**：
   - 如果只需要模型结构，选择"仅导入模型结构"
   - 如果需要完整的计算逻辑，选择"导入模型结构和计算流程"

3. **使用描述性的版本信息**：
   - 版本号：使用有意义的命名规则
   - 版本名称：清楚说明版本用途
   - 版本描述：记录导入来源、时间、用途等信息

4. **导入后及时验证**：
   - 检查模型结构是否完整
   - 如果导入了计算流程，测试SQL代码是否正常
   - 验证数据源配置是否正确

5. **本地化调整**：
   - 根据本机构的实际情况调整模型结构
   - 修改不适用的节点或维度
   - 调整权重和单价

6. **版本管理**：
   - 定期清理不再使用的导入版本
   - 保持版本命名的一致性
   - 记录版本的演变历史

## 技术支持

如果在使用过程中遇到问题，请联系：
- 技术支持邮箱：support@example.com
- 技术支持电话：400-XXX-XXXX
- 在线帮助文档：http://docs.example.com

---

**文档版本**：V1.0  
**最后更新**：2025-11-05  
**适用系统版本**：V1.5+
